---
title: 'Advanced Time Series Analysis: Computer Exercise 2'
author: "Anders Launer Bæk (s160159)"
date: "`r format(Sys.time(), '%d %B %Y')`"
header-includes: 
    - \usepackage{graphicx}
output:
  pdf_document: default
---

```{r setup, include=FALSE}
rm(list = ls())

knitr::opts_chunk$set(echo = FALSE, 
                      include = TRUE,
                      warning = FALSE,
                      fig.width = 8, fig.height = 4,
                      fig.show='hold', fig.align='center',
                      
                      eval = TRUE, 
                      tidy = TRUE, 
                      dev = 'pdf', 
                      cache = TRUE, fig.pos = "th!")

kable_format <- list(small.mark = ",",
                     big.mark = ',',
                     decimal.mark = '.',
                     nsmall = 3,
                     digits = 3,
                     scientific = FALSE,
                     big.interval = 3L)

library(ggplot2)
theme_TS <- function(base_size = 9, base_family = "", face = "plain"){
  theme_bw(base_size = base_size, base_family = base_family) %+replace%
    theme(panel.background = element_blank(), 
          panel.border = element_blank(),
          panel.grid = element_blank(),
          axis.text = element_text(size = base_size, face = face, family = base_family),
          axis.title = element_text(size = base_size, face = face, family = base_family),
          legend.text = element_text(size = base_size, face = face, family = base_family))
}

```
Sparring partners:
\begin{itemize}
\item Anja Liljedahl Christensen (s162876)
\item Marie Mørk (s112770)
\end{itemize}

## Part 1
There are simulated $n=3000$ where $\epsilon_t \sim \mathcal{N}(0,\,1)$. $\epsilon_t$ is used as noise input for all simulations in part one.

```{r}
## Number of samplepoints
n <- 1000
load(file = "~/DTU/Courses/Advanced Time Series/Projects/noise.Rda")

data <- data.frame(t = 1:n, noise = r[1:n])

# define parameter for SETAR
a0 <- c(0.125, -0.125) # off set
a1 <- c(0.6, -0.4) # slope

```

The equation below shows the used parameters in the SETAR(2,1,1). Let us call eq. \ref{eq_1_2a} and eq. \ref{eq_1_2b} parameter set one ($par_1$).

\begin{equation}
a_0 = [`r a0[1]`, `r a0[2]`]
\label{eq_1_2a}
\end{equation}
\begin{equation}
a_1 = [`r a1[1]`, `r a1[2]`]
\label{eq_1_2b}
\end{equation}

 
### Simulation of the SETAR(2,1,1)

The Self-Exciting Threshold AR (SETAR) model is given by eq. \ref{eq_1_SETAR}.

\begin{equation}
X_t = a_0^{(J_t)} + \sum_{i = 1}^{k_{(J_t)}} a_i^{(J_t)} X_{t-i}+\epsilon^{(J_t)}
\label{eq_1_SETAR}
\end{equation}
where $J_t$ are regime processes. The complete model are defined in eq. \ref{eq_1_SETAR_r}.

\begin{equation}
X_t = \left\{ \begin{matrix} a_{0,1} + a_{1,1} X_{t- 1} + \epsilon_t & for & X_{t-1} \leq0 \\  a_{0,2} + a_{1,2} X_{t- 1} + \epsilon_t &  for & X_{t-1} >0 \end{matrix} \right\}
\label{eq_1_SETAR_r}
\end{equation}

The model $X_t$ (eq. \ref{eq_1_SETAR_r}) has been simulated with $par_1$. Its simulation is plotted in fig. \ref{fig_ex_2}. 

```{r, fig.cap="\\label{fig_ex_1}Two simulated SETAR(2,1,1) models using $par_1$ and $par_2$."}
## Make a time series y with a regime model
data$y_SETAR <- rep(NA,n)
data$y_SETAR[1] <- data$noise[1]

for(t in 2:n) {
  if(data$y_SETAR[t - 1] <= 0) {
    data$y_SETAR[t] <- a0[1] + a1[1] * data$y_SETAR[t-1] + data$noise[t]
  } else {
    data$y_SETAR[t] <- a0[2] + a1[2] * data$y_SETAR[t-1] + data$noise[t]
  }
}

#
data$y_SETAR_1 <- rep(NA, n)
data$y_SETAR_1[2:n] <- data$y_SETAR[1:(n-1)]

# plot data
ggplot(data) +
  geom_point(aes(x = y_SETAR_1, y = y_SETAR, color = "SETAR(2,1,1)"), alpha = 1/2) +
  #ylim(0, 1) +
  labs(x = "y(t - 1)", y = "y(t)", color = "") +
  theme_TS()
```

### Estimate the parameters using conditional least squares

see section 5.5 page 115

```{r, echo=TRUE}
RSSSetar <- function(theta) {
  p1 <- theta[1]
  p2 <- theta[2]
  
  ## Calculate the objective function value
  obj <- 1
  
  #
  return(obj) 
}
```



